<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R代码展示 - 肺癌保险研究分析</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['Consolas', 'Monaco', 'monospace']
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .code-block {
                @apply bg-dark text-gray-100 rounded-lg p-4 overflow-x-auto font-mono text-sm leading-relaxed;
            }
            .line-number {
                @apply text-gray-500 pr-4 select-none;
            }
            .keyword {
                @apply text-blue-400;
            }
            .function {
                @apply text-yellow-400;
            }
            .string {
                @apply text-green-400;
            }
            .comment {
                @apply text-gray-400 italic;
            }
            .number {
                @apply text-purple-400;
            }
            .operator {
                @apply text-pink-400;
            }
            .class {
                @apply text-orange-400;
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">
    <div class="min-h-screen flex flex-col">
        <!-- 顶部导航 -->
        <header class="bg-white shadow-md sticky top-0 z-10">
            <div class="container mx-auto px-4 py-4 flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <i class="fa fa-code text-primary text-2xl"></i>
                    <h1 class="text-xl font-bold text-dark">R代码展示</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="#" class="text-gray-600 hover:text-primary transition-colors duration-200">
                        <i class="fa fa-home mr-1"></i> 首页
                    </a>
                    <a href="#" class="text-gray-600 hover:text-primary transition-colors duration-200">
                        <i class="fa fa-github mr-1"></i> GitHub
                    </a>
                    <button id="copyBtn" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg flex items-center">
                        <i class="fa fa-copy mr-2"></i> 复制代码
                    </button>
                </div>
            </div>
        </header>

        <!-- 主要内容 -->
        <main class="flex-grow container mx-auto px-4 py-8">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold mb-4 text-dark flex items-center">
                    <i class="fa fa-file-text-o text-primary mr-2"></i> 肺癌保险研究分析
                </h2>
                <p class="text-gray-600 mb-6">这是一个使用R语言进行肺癌保险研究的数据分析项目，主要包括数据准备与整合、描述性统计、差异解释模型和预测分析等内容。</p>
                
                <div class="flex justify-between items-center mb-4">
                    <div class="text-sm text-gray-500">
                        <span class="mr-4"><i class="fa fa-code-fork mr-1"></i> R语言</span>
                        <span><i class="fa fa-database mr-1"></i> 数据分析</span>
                    </div>
                    <div class="flex space-x-2">
                        <button id="toggleLineNumbers" class="text-sm bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded transition-colors duration-200">
                            <i class="fa fa-list-ol mr-1"></i> 行号
                        </button>
                        <button id="toggleTheme" class="text-sm bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded transition-colors duration-200">
                            <i class="fa fa-moon-o mr-1"></i> 暗色
                        </button>
                    </div>
                </div>
                
                <!-- 代码区域 -->
                <div class="relative">
                    <div id="codeContainer" class="code-block">
<pre><code><span class="comment">## 加载需要的包</span>
<span class="keyword">library</span>(<span class="function">tidyverse</span>)
<span class="keyword">library</span>(<span class="function">readxl</span>)
<span class="keyword">library</span>(<span class="function">nnet</span>)
<span class="keyword">library</span>(<span class="function">prophet</span>)
<span class="keyword">library</span>(<span class="function">ggplot2</span>)
<span class="keyword">library</span>(<span class="function">gridExtra</span>)
<span class="keyword">library</span>(<span class="function">broom</span>)

<span class="comment">###------------------------------数据准备与整合------------------------------###</span>
<span class="comment"># 读取数据</span>
data1 &lt;- <span class="function">read_excel</span>(<span class="string">"C:/Users/Barry/Desktop/“寿再青骏杯”选题二数据：肺癌保险研究/【选题2数据】某保险产品肺癌发生率及初次确诊分期分布.xlsx"</span>,<span class="function">sheet</span> = 2)
data2 &lt;- <span class="function">read_excel</span>(<span class="string">"C:/Users/Barry/Desktop/“寿再青骏杯”选题二数据：肺癌保险研究/【选题2数据】某保险产品肺癌发生率及初次确诊分期分布.xlsx"</span>,<span class="function">sheet</span> = 3)

<span class="comment"># 更改列名方便后续处理</span>
<span class="function">colnames</span>(data1) &lt;- <span class="function">c</span>(<span class="string">'gender'</span>, <span class="string">'age'</span>, <span class="string">'year'</span>,<span class="string">'claims'</span>,<span class="string">'exposure'</span>)
<span class="function">colnames</span>(data2) &lt;- <span class="function">c</span>(<span class="string">'gender'</span>, <span class="string">'age'</span>, <span class="string">'stage'</span>,<span class="string">'year'</span>,<span class="string">'claims'</span>)

<span class="comment"># 整理分组</span>
data2 &lt;- data2 %&gt;%
  <span class="function">mutate</span>(
    age_group = <span class="function">case_when</span>(
      age == <span class="string">'40岁及以下'</span> ~ <span class="string">"&lt;=40"</span>,
      age == <span class="string">'41-50岁'</span> ~ <span class="string">"41-50"</span>,
      age == <span class="string">'51-60岁'</span> ~ <span class="string">"51-60"</span>,
      <span class="keyword">TRUE</span> ~ <span class="string">"61+"</span>
    )
  )

<span class="comment"># 按性别、年龄组、年份、分期汇总data2的分期理赔数</span>
data2_agg &lt;- data2 %&gt;%
  <span class="function">group_by</span>(gender, age_group, year, stage) %&gt;%
  <span class="function">summarise</span>(
    stage_claims = <span class="function">sum</span>(claims),              <span class="comment"># 先汇总各分期的理赔数</span>
    .groups = <span class="string">"drop"</span>
  ) %&gt;%
  <span class="comment"># 再按性别、年龄组、年份分组计算占比</span>
  <span class="function">group_by</span>(gender, age_group, year) %&gt;%
  <span class="function">mutate</span>(
    total_claims = <span class="function">sum</span>(stage_claims),         <span class="comment"># 分组总理赔数</span>
    stage_prop = stage_claims / total_claims  <span class="comment"># 分期占比</span>
  ) %&gt;%
  <span class="function">ungroup</span>() %&gt;%  <span class="comment"># 解除分组</span>
  <span class="function">mutate</span>(
    stage_prop = <span class="function">ifelse</span>(<span class="function">is.nan</span>(stage_prop), 0, stage_prop)  <span class="comment"># 处理零除情况</span>
  )

merged_data &lt;- data2_agg[<span class="function">order</span>(data2_agg$gender, data2_agg$age_group, data2_agg$year), ]

<span class="comment"># 删除缺失值（无理赔的组）</span>
merged_data &lt;- <span class="function">na.omit</span>(merged_data)

<span class="comment">###---------------------------描述性统计与基本分析---------------------------###</span>
<span class="comment"># 1. 各分期的总索赔数 & 均值 & 标准差</span>
desc_stage &lt;- merged_data %&gt;%
  <span class="function">group_by</span>(stage) %&gt;%
  <span class="function">summarise</span>(
    sum_claims = <span class="function">sum</span>(stage_claims),
    mean_claims = <span class="function">mean</span>(stage_claims),
    sd_claims   = <span class="function">sd</span>(stage_claims),
  )

<span class="comment"># 2. 性别 + 年龄组 的总理赔 & 平均占比</span>
desc_gender_age &lt;- merged_data %&gt;%
  <span class="function">group_by</span>(gender, age_group) %&gt;%
  <span class="function">summarise</span>(
    total_claims = <span class="function">sum</span>(stage_claims),
    avg_prop     = <span class="function">mean</span>(stage_prop)
  )

<span class="comment"># 查看结果</span>
desc_stage
desc_gender_age

<span class="comment">## 数据可视化</span>
<span class="comment"># 1. 各分期总理赔数柱状图</span>
p1 &lt;- <span class="function">ggplot</span>(merged_data, <span class="function">aes</span>(x = <span class="function">factor</span>(stage), y = stage_claims)) +
  <span class="function">stat_summary</span>(fun = <span class="function">sum</span>, geom = <span class="string">"col"</span>, fill = <span class="string">"steelblue"</span>) +
  <span class="function">labs</span>(title = <span class="string">"各分期总理赔数"</span>,
       x = <span class="string">"分期"</span>,
       y = <span class="string">"总理赔数"</span>) +
  <span class="function">theme_minimal</span>()

<span class="comment"># 2. 年度各分期理赔数趋势折线图</span>
p2 &lt;- <span class="function">ggplot</span>(merged_data, <span class="function">aes</span>(x = year, y = stage_claims, color = <span class="function">factor</span>(stage))) +
  <span class="function">stat_summary</span>(fun = <span class="function">sum</span>, geom = <span class="string">"line"</span>, size = 1) +
  <span class="function">labs</span>(title = <span class="string">"年度各分期理赔数趋势"</span>,
       x = <span class="string">"年份"</span>,
       y = <span class="string">"理赔数"</span>,
       color = <span class="string">"分期"</span>) +
  <span class="function">theme_minimal</span>()

g1 &lt;- <span class="function">grid.arrange</span>(p1, p2, ncol = 2)
<span class="comment"># 保存为 JPG 格式</span>
<span class="function">ggsave</span>(
  filename = <span class="string">"C:/Users/Barry/Desktop/“寿再青骏杯”选题二数据：肺癌保险研究/graph/1.jpg"</span>,    <span class="comment"># 文件名（扩展名决定格式）</span>
  plot = g1,                       <span class="comment"># 绘图对象</span>
  width = 8,                       <span class="comment"># 宽度（单位英寸）</span>
  height = 6,                      <span class="comment"># 高度（单位英寸）</span>
  units = <span class="string">"in"</span>,                    <span class="comment"># 单位（默认英寸）</span>
  dpi = 300                        <span class="comment"># 分辨率（默认 300 dpi）</span>
)

<span class="comment"># 3. 性别 + 年龄组 分期占比热力图 </span>
<span class="comment"># 3.1 聚合：计算性别×年龄组×分期 的平均占比</span>
heat_data &lt;- merged_data %&gt;%
  <span class="function">group_by</span>(gender, age_group, stage) %&gt;%
  <span class="function">summarise</span>(
    mean_prop = <span class="function">mean</span>(stage_prop, na.rm = <span class="keyword">TRUE</span>),
    .groups = <span class="string">"drop"</span>
  )

<span class="comment"># 3.2 绘图</span>
g2 &lt;- <span class="function">ggplot</span>(heat_data, <span class="function">aes</span>(x = age_group,
                      y = <span class="function">factor</span>(stage),
                      fill = mean_prop)) +
  <span class="function">geom_tile</span>(color = <span class="string">"white"</span>) +
  <span class="function">facet_wrap</span>(~ gender) +
  <span class="function">scale_fill_gradient</span>(low = <span class="string">"lightblue"</span>, high = <span class="string">"darkblue"</span>) +
  <span class="function">labs</span>(
    title = <span class="string">"性别与年龄组下各分期平均占比热力图"</span>,
    x     = <span class="string">"年龄组"</span>,
    y     = <span class="string">"分期"</span>,
    fill  = <span class="string">"平均占比"</span>
  ) +
  <span class="function">theme_minimal</span>() +
  <span class="function">theme</span>(
    axis.text.x = <span class="function">element_text</span>(angle = 45, hjust = 1)
  )
<span class="comment"># 保存为 JPG 格式</span>
<span class="function">ggsave</span>(
  filename = <span class="string">"C:/Users/Barry/Desktop/“寿再青骏杯”选题二数据：肺癌保险研究/graph/2.jpg"</span>,    <span class="comment"># 文件名（扩展名决定格式）</span>
  plot = g2,                       <span class="comment"># 绘图对象</span>
  width = 8,                       <span class="comment"># 宽度（单位英寸）</span>
  height = 6,                      <span class="comment"># 高度（单位英寸）</span>
  units = <span class="string">"in"</span>,                    <span class="comment"># 单位（默认英寸）</span>
  dpi = 300                        <span class="comment"># 分辨率（默认 300 dpi）</span>
)

<span class="comment">###------------------------差异解释模型：多项逻辑回归------------------------###</span>
<span class="comment"># 将分类变量转为因子变量</span>
merged_data &lt;- merged_data %&gt;%
  <span class="function">mutate</span>(<span class="function">across</span>(c(<span class="string">"gender"</span>,<span class="string">"age_group"</span>,<span class="string">"stage"</span>), <span class="function">as.factor</span>))

<span class="comment"># 对年份去中心化，让截距对应一个真实存在的时点</span>
merged_data &lt;- merged_data %&gt;%
  <span class="function">mutate</span>(year_c = year - <span class="function">mean</span>(year))

<span class="comment"># 训练多项逻辑回归模型</span>
model &lt;- <span class="function">multinom</span>(
  stage ~ gender + age_group + year_c,
  data = merged_data,
  weights = stage_claims
)

<span class="function">summary</span>(model)

<span class="comment"># 用broom::tidy 一步拿到系数、标准误、置信区间</span>
tbl &lt;- <span class="function">tidy</span>(model, 
            exponentiate = <span class="keyword">FALSE</span>,  <span class="comment"># 先拿 log‑odds</span>
            conf.int     = <span class="keyword">TRUE</span>)   <span class="comment"># 拿到 conf.low, conf.high</span>

<span class="comment"># 计算 z、p、OR储存到tbl2中</span>
tbl2 &lt;- tbl %&gt;%
  <span class="function">mutate</span>(
    z       = estimate / std.error,
    p.value = 2 * (1 - <span class="function">pnorm</span>(<span class="function">abs</span>(z))),
    OR      = <span class="function">exp</span>(estimate),
    CI_low  = <span class="function">exp</span>(conf.low),
    CI_high = <span class="function">exp</span>(conf.high))

<span class="comment"># 简单森林图</span>
g3 &lt;- <span class="function">ggplot</span>(tbl2, <span class="function">aes</span>(x = OR, y = term, color = y.level)) +
  <span class="function">geom_errorbarh</span>(<span class="function">aes</span>(xmin = CI_low, xmax = CI_high),
                 height = 0.3,          <span class="comment"># 线端横线的“厚度”</span>
                 size   = 0.8,          <span class="comment"># 误差线宽度</span>
                 position = <span class="function">position_dodge</span>(width = 0.7)) +
  <span class="function">geom_point</span>(position = <span class="function">position_dodge</span>(width = 0.7),
             size = 3) +            <span class="comment"># 点的大小</span>
  <span class="function">geom_vline</span>(xintercept = 1, linetype = <span class="string">"dashed"</span>, color = <span class="string">"gray50"</span>) +
  <span class="function">scale_x_log10</span>(
    <span class="comment"># 缩小左右空白</span>
    expand = <span class="function">expansion</span>(mult = <span class="function">c</span>(0.1, 0.1))
  ) +
  <span class="function">labs</span>(
    x     = <span class="string">"Odds Ratio (对数尺度) 与 95% CI"</span>,
    y     = <span class="string">"自变量项"</span>,
    color = <span class="string">"分期 (stage)"</span>,
    title = <span class="string">"多项逻辑回归：各因素对不同分期 vs Ⅰ期的 OR"</span>
  ) +
  <span class="function">theme_minimal</span>(base_size = 14) +
  <span class="function">theme</span>(
    <span class="comment"># 适当压缩上下空白</span>
    plot.margin = <span class="function">margin</span>(10, 10, 10, 10),
    <span class="comment"># 调整 y 轴文字与点更紧凑</span>
    axis.title.y = <span class="function">element_blank</span>(),
    axis.text.y  = <span class="function">element_text</span>(margin = <span class="function">margin</span>(r = 5)),
    legend.position = <span class="string">"right"</span>
  )

<span class="comment"># 保存为 JPG 格式</span>
<span class="function">ggsave</span>(
  filename = <span class="string">"C:/Users/Barry/Desktop/“寿再青骏杯”选题二数据：肺癌保险研究/graph/3.jpg"</span>,    <span class="comment"># 文件名（扩展名决定格式）</span>
  plot = g3,                       <span class="comment"># 绘图对象</span>
  width = 8,                       <span class="comment"># 宽度（单位英寸）</span>
  height = 6,                      <span class="comment"># 高度（单位英寸）</span>
  units = <span class="string">"in"</span>,                    <span class="comment"># 单位（默认英寸）</span>
  dpi = 300                        <span class="comment"># 分辨率（默认 300 dpi）</span>
)

<span class="comment">##获取各类别的概率</span>
<span class="comment"># 使用 fitted() 获取模型的预测概率</span>
pred_probs &lt;- <span class="function">fitted</span>(model)

<span class="comment"># 将预测结果转化为数据框</span>
pred_data &lt;- <span class="function">as.data.frame</span>(pred_probs)
<span class="function">colnames</span>(pred_data) &lt;- <span class="function">paste</span>(<span class="string">"stage"</span>, 1:<span class="function">ncol</span>(pred_data), sep = <span class="string">"_"</span>)
pred_data$gender &lt;- <span class="function">rep</span>(merged_data$gender, length.out = <span class="function">nrow</span>(pred_data))
pred_data$age_group &lt;- <span class="function">rep</span>(merged_data$age_group, length.out = <span class="function">nrow</span>(pred_data))
pred_data$year_c &lt;- <span class="function">rep</span>(merged_data$year_c, length.out = <span class="function">nrow</span>(pred_data))

<span class="comment"># 将数据重塑为长格式，以便绘图</span>
pred_data_long &lt;- pred_data %&gt;%
  <span class="function">pivot_longer</span>(cols = <span class="function">starts_with</span>(<span class="string">"stage"</span>), 
               names_to = <span class="string">"stage"</span>, 
               values_to = <span class="string">"probability"</span>)

<span class="comment">###-------------------可视化不同人群与癌症分期之间的关系-------------------###</span>
<span class="comment"># 先计算真实年份的平均值</span>
year_mean &lt;- <span class="function">mean</span>(merged_data$year)

<span class="comment"># 绘图</span>
g4 &lt;- <span class="function">ggplot</span>(pred_data_long, <span class="function">aes</span>(
  x = year_c,
  y = probability,
  color = gender,
  linetype = gender,
  linewidth = age_group
)) +
  <span class="function">geom_line</span>(show.legend = <span class="keyword">TRUE</span>) +
  <span class="function">facet_wrap</span>(~ stage) +
  <span class="function">scale_linewidth_manual</span>(
    values = <span class="function">c</span>(
      <span class="string">"&lt;=40"</span>  = 0.5,
      <span class="string">"41-50"</span> = 1.0,
      <span class="string">"51-60"</span> = 1.5,
      <span class="string">"61+"</span>   = 2.0
    )
  ) +
  <span class="function">scale_x_continuous</span>(
    name = <span class="string">"年份"</span>,
    breaks = <span class="function">seq</span>(-6, 6, 2),  <span class="comment"># 根据你的数据调整刻度范围</span>
    labels = <span class="function">function</span>(x) <span class="function">round</span>(x + year_mean)
  ) +
  <span class="function">labs</span>(
    title = <span class="string">"不同人群肺癌分期的概率趋势"</span>,
    y = <span class="string">"概率"</span>,
    color = <span class="string">"性别"</span>,
    linetype = <span class="string">"性别"</span>,
    linewidth = <span class="string">"年龄组"</span>
  ) +
  <span class="function">theme_minimal</span>(base_size = 14)
<span class="comment"># 保存为 JPG 格式</span>
<span class="function">ggsave</span>(
  filename = <span class="string">"C:/Users/Barry/Desktop/“寿再青骏杯”选题二数据：肺癌保险研究/graph/4.jpg"</span>,    <span class="comment"># 文件名（扩展名决定格式）</span>
  plot = g4,                       <span class="comment"># 绘图对象</span>
  width = 8,                       <span class="comment"># 宽度（单位英寸）</span>
  height = 6,                      <span class="comment"># 高度（单位英寸）</span>
  units = <span class="string">"in"</span>,                    <span class="comment"># 单位（默认英寸）</span>
  dpi = 300                        <span class="comment"># 分辨率（默认 300 dpi）</span>
)

<span class="comment">###---------------------------------模型预测---------------------------------###</span>
<span class="comment"># 构造未来年份的预测数据框</span>
future_years &lt;- 2021:2030
pred_data_future &lt;- <span class="function">expand.grid</span>(
  gender    = <span class="function">levels</span>(merged_data$gender),
  age_group = <span class="function">levels</span>(merged_data$age_group),
  year      = future_years
)

<span class="comment"># 去中心化年份（与训练数据保持一致）</span>
year_mean &lt;- <span class="function">mean</span>(merged_data$year)
pred_data_future$year_c &lt;- pred_data_future$year - year_mean

<span class="comment"># 使用模型预测每个癌症分期的概率</span>
pred_probs &lt;- <span class="function">predict</span>(model, newdata = pred_data_future, type = <span class="string">"probs"</span>)

<span class="comment"># 合并预测结果为一个数据框</span>
pred_data_end &lt;- <span class="function">cbind</span>(pred_data_future, <span class="function">as.data.frame</span>(pred_probs))

<span class="comment"># 获取模型预测概率列名（非 predictor 列）</span>
prob_cols &lt;- <span class="function">setdiff</span>(<span class="function">colnames</span>(pred_data_end), <span class="function">c</span>(<span class="string">"gender"</span>, <span class="string">"age_group"</span>, <span class="string">"year"</span>, <span class="string">"year_c"</span>))

<span class="comment"># 整理为长表形式</span>
pred_data_end &lt;- pred_data_end %&gt;%
  <span class="function">pivot_longer</span>(
    cols = <span class="function">all_of</span>(prob_cols),
    names_to = <span class="string">"stage"</span>,
    values_to = <span class="string">"probability"</span>
  )

<span class="comment">## 真实值和预测值结合的不同癌症分期概率趋势图</span>
<span class="comment"># 构建真实数据结尾部分的概率表</span>
real_data_end &lt;- merged_data %&gt;%
  <span class="function">select</span>(gender, age_group, year, year_c, stage, stage_prop) %&gt;%
  <span class="function">rename</span>(probability = stage_prop) %&gt;%
  <span class="function">mutate</span>(source = <span class="string">"真实"</span>)

<span class="comment"># 构建预测数据概率表</span>
pred_data_long2 &lt;- pred_data_end %&gt;%
  <span class="function">mutate</span>(source = <span class="string">"预测"</span>)

<span class="comment"># 合并过去与预测数据</span>
combined_data &lt;- <span class="function">bind_rows</span>(real_data_end, pred_data_long2)

<span class="comment"># 绘图：不同颜色表示真实/预测，线型区分性别，线宽区分年龄组</span>
g5 &lt;- <span class="function">ggplot</span>(combined_data, <span class="function">aes</span>(
  x = year,
  y = probability,
  color = source,
  linetype = gender,
  linewidth = age_group,
  group = <span class="function">interaction</span>(gender, age_group, source)
)) +
  <span class="function">geom_line</span>() +
  <span class="function">facet_wrap</span>(~ stage) +
  <span class="function">scale_linewidth_manual</span>(values = <span class="function">c</span>(<span class="string">"&lt;=40"</span> = 0.5, <span class="string">"41-50"</span> = 1.0, <span class="string">"51-60"</span> = 1.5, <span class="string">"61+"</span> = 2.0)) +
  <span class="function">scale_color_manual</span>(
    values = <span class="function">c</span>(<span class="string">"#2E5D87"</span>, <span class="string">"#E48C2A"</span>),
    labels = <span class="function">c</span>(<span class="string">"过去值"</span>, <span class="string">"预测值"</span>)
  ) +
  <span class="function">labs</span>(
    title = <span class="string">"肺癌各分期的过去与预测概率趋势"</span>,
    x = <span class="string">"年份"</span>,
    y = <span class="string">"概率"</span>,
    color = <span class="string">"数据来源"</span>,
    linetype = <span class="string">"性别"</span>,
    linewidth = <span class="string">"年龄组"</span>
  ) +
  <span class="function">theme_minimal</span>(base_size = 14)
<span class="comment"># 保存为 JPG 格式</span>
<span class="function">ggsave</span>(
  filename = <span class="string">"C:/Users/Barry/Desktop/“寿再青骏杯”选题二数据：肺癌保险研究/graph/5.jpg"</span>,    <span class="comment"># 文件名（扩展名决定格式）</span>
  plot = g5,                       <span class="comment"># 绘图对象</span>
  width = 8,                       <span class="comment"># 宽度（单位英寸）</span>
  height = 6,                      <span class="comment"># 高度（单位英寸）</span>
  units = <span class="string">"in"</span>,                    <span class="comment"># 单位（默认英寸）</span>
  dpi = 300                        <span class="comment"># 分辨率（默认 300 dpi）</span>
)</code></pre>
                    </div>
                    
                    <!-- 复制成功提示 -->
                    <div id="copyNotification" class="hidden fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50">
                        <i class="fa fa-check mr-2"></i> 代码已复制到剪贴板
                    </div>
                </div>
            </div>
            
            <!-- 代码功能说明 -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4 text-dark flex items-center">
                        <i class="fa fa-info-circle text-primary mr-2"></i> 代码功能概述
                    </h3>
                    <ul class="space-y-3 text-gray-700">
                        <li class="flex items-start">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>数据准备与整合：读取Excel数据，整理分组并计算分期占比</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>描述性统计：分析各分期理赔数、性别和年龄组分布</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>数据可视化：创建柱状图、折线图、热力图等多种图表</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>差异解释模型：使用多项逻辑回归分析影响因素</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>模型预测：预测未来年份不同人群的癌症分期概率</span>
                        </li>
                    </ul>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4 text-dark flex items-center">
                        <i class="fa fa-lightbulb-o text-primary mr-2"></i> 使用提示
                    </h3>
                    <ul class="space-y-3 text-gray-700">
                        <li class="flex items-start">
                            <i class="fa fa-arrow-right text-secondary mt-1 mr-2"></i>
                            <span>点击右上角"复制代码"按钮可将代码复制到剪贴板</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fa fa-arrow-right text-secondary mt-1 mr-2"></i>
                            <span>点击"行号"按钮可切换是否显示代码行号</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fa fa-arrow-right text-secondary mt-1 mr-2"></i>
                            <span>点击"暗色"按钮可切换代码区域的明暗主题</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fa fa-arrow-right text-secondary mt-1 mr-2"></i>
                            <span>代码区域支持横向滚动，适合查看较长的代码行</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fa fa-arrow-right text-secondary mt-1 mr-2"></i>
                            <span>代码使用了基本的语法高亮，便于阅读和理解</span>
                        </li>
                    </ul>
                </div>
            </div>
        </main>

        <!-- 页脚 -->
        <footer class="bg-dark text-white py-6">
            <div class="container mx-auto px-4">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="mb-4 md:mb-0">
                        <div class="flex items-center space-x-2">
                            <i class="fa fa-code text-primary text-xl"></i>
                            <span class="font-bold text-lg">R代码展示</span>
                        </div>
                        <p class="text-gray-400 text-sm mt-2">肺癌保险研究分析</p>
                    </div>
                    
                    <div class="flex space-x-6">
                        <a href="#" class="text-gray-400 hover:text-white transition-colors duration-200">
                            <i class="fa fa-github text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors duration-200">
                            <i class="fa fa-linkedin text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors duration-200">
                            <i class="fa fa-twitter text-xl"></i>
                        </a>
                    </div>
                </div>
                
                <div class="border-t border-gray-700 mt-6 pt-6 text-center text-gray-400 text-sm">
                    &copy; 2025 R代码展示平台. 保留所有权利.
                </div>
            </div>
        </footer>
    </div>

    <!-- JavaScript -->
    <script>
        // 复制代码功能
        document.getElementById('copyBtn').addEventListener('click', function() {
            const codeElement = document.querySelector('#codeContainer pre code');
            const textToCopy = codeElement.textContent;
            
            navigator.clipboard.writeText(textToCopy).then(function() {
                // 显示复制成功提示
                const notification = document.getElementById('copyNotification');
                notification.classList.remove('hidden');
                
                // 3秒后隐藏提示
                setTimeout(() => {
                    notification.classList.add('hidden');
                }, 3000);
            });
        });
        
        // 切换行号显示
        let showLineNumbers = true;
        document.getElementById('toggleLineNumbers').addEventListener('click', function() {
            showLineNumbers = !showLineNumbers;
            const codeLines = document.querySelectorAll('#codeContainer pre code');
            
            if (showLineNumbers) {
                codeLines.forEach(line => {
                    line.innerHTML = line.innerHTML.replace(/<span class="line-number">(\d+)<\/span>/g, '<span class="line-number">$1</span>');
                });
                this.innerHTML = '<i class="fa fa-list-ol mr-1"></i> 行号';
            } else {
                codeLines.forEach(line => {
                    line.innerHTML = line.innerHTML.replace(/<span class="line-number">\d+<\/span>/g, '');
                });
                this.innerHTML = '<i class="fa fa-list-ol mr-1"></i> 显示行号';
            }
        });
        
        // 切换代码主题
        let darkMode = false;
        document.getElementById('toggleTheme').addEventListener('click', function() {
            darkMode = !darkMode;
            const codeBlock = document.getElementById('codeContainer');
            
            if (darkMode) {
                codeBlock.classList.remove('bg-dark', 'text-gray-100');
                codeBlock.classList.add('bg-gray-100', 'text-gray-800');
                this.innerHTML = '<i class="fa fa-sun-o mr-1"></i> 亮色';
            } else {
                codeBlock.classList.remove('bg-gray-100', 'text-gray-800');
                codeBlock.classList.add('bg-dark', 'text-gray-100');
                this.innerHTML = '<i class="fa fa-moon-o mr-1"></i> 暗色';
            }
        });
        
        // 为代码添加行号
        document.addEventListener('DOMContentLoaded', function() {
            const codeElement = document.querySelector('#codeContainer pre code');
            const lines = codeElement.textContent.split('\n');
            let lineNumberedCode = '';
            
            lines.forEach((line, index) => {
                lineNumberedCode += `<span class="line-number">${index + 1}</span>${line}\n`;
            });
            
            codeElement.innerHTML = lineNumberedCode;
        });
    </script>
</body>
</html>